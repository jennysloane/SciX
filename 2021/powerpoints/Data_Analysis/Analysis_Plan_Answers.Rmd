---
title: "DataAnalysis_Example_Template"
output: html_document
---

This script is written for you to learn how to look into the data from our experiment and to prepare it to test your hypotheses. Most of these skills were covered in the Data Analysis Lecture with R, so you can refer to the recorded lecture if you get stuck.   

#### PART 1 #### 

### Libraries Loading 
Please add in the R line below the libraries that you will need to start off. Don't worry if you don't know all of them right now, you can add more as you progress. Remember, if you haven't used a package before, you'll have to install it first like this: install.packages("name of your package").

```{r}
library(tidyverse)
library(ggeasy)
```

### Data Loading 
We start with calling the data in. Read in the .csv file that contains all the collected data from our experiment, it's called "scix_data.csv", you should see it in the Files tab. Save it to a new variable called "all_data". 

Look at the top 6 rows of data using the head() function.

```{r}
all_data <- read.csv("clean_data/scix_data.csv")
```

### Data Inspection
Inspect the data structure and look for the names of the columns you will need to test your hypothesis. Use the str() function to do this. How many observations are there? How many variables are there? Hint: it's a lot - over 100 variables!! 

```{r}
str(all_data)
```

Because there are so many variables, you will see it says "list output truncated", meaning it's too many to list. So, in order to have a look at the full dataset, try running this: View(all_data) or you can click on the all_data variable in the top right corner in your environment. You can scroll across to see the first 50 column names. In order to see the rest, above the column names there are arrows to navigate through the columns. 

```{r}
View(all_data)
```

### Variables Selection
Now, this dataset is a bit overwhelming, so your next task is to create a smaller dataset that will consist only of the variables you are going to test in your hypothesis. Select the variables of interest and store them under a new name called "my_data". 

For those of you who have surveys, you'll need to select several columns for each survey. For example, the Big 5 has 15 questions, so there are 15 columns. The first question is "big5_1" and goes all the way to "big5_15". Here's a trick to select multiple columns at once: select(pid, big5_1:big5_15). This will select the participant ID and the 15 columns for the big5 survey. You can select as many variables as you need.  

Important, it is good practice to leave participants IDs so you can track the choices for each individual if you wanted to. Remember how to pipe? We'll help get you started.

```{r}
my_data <- all_data %>%
  as_tibble() %>% # this line will make your data a little easier to read 
  select(pid, big5_1:big5_15) ## which columns do you want to select, fill in here!

```

### Structure Inspection
Once again, look into the types of the variables in your new (shortened) dataset below. This step will help you to make informed decision about whether you need to change their types, what stat. test you will conduct etc. 

```{r}
str(my_data)
```

### Transformation of Variable (if neccesary)
If in the previous step (i.e. in Structure Inspection), you could see that the variables you were interested in are not of the correct type (e.g. "numerical" variable are coded as "character" type), you should transform their types now. Don't forget: if your variables are not of the correct type, you might encounter problems later when you try to plot them or to conduct statistical tests on them. 
```{r}

```

### Reverse Coding (if applied)
If you are using any of the surveys for your hypothesis (some of the questions require reverse coding) or if you wish to have one of the variables coded in a different form than the current one (e.g. you want to have gender coded not only as F/M but also as 0/1), now is the time!! 

```{r}
big5_reverse <- my_data %>%
  mutate(big5_3R = dplyr::recode(big5_3, "0" = "4", "1" = "3", "2" = "2", "3" = "1", "4" = "0"),
         big5_6 = dplyr::recode(my_data$big5_6, "0" = "4", "1" = "3", "2" = "2", "3" = "1", "4" = "0"),
         big5_10 = dplyr::recode(my_data$big5_10, "0" = "4", "1" = "3", "2" = "2", "3" = "1", "4" = "0"),
         big5_14 = dplyr::recode(my_data$big5_14, "0" = "4", "1" = "3", "2" = "2", "3" = "1", "4" = "0"))
  

```

#### PART 2 #### 

Great job so far!! 

For the next part, we've gone ahead and organized and "tidied" (do you remember what tidy data is from RYouWithMe?) the data for you to make it much easier to complete your analyses. In the Files tab, you'll see many "tidy" .csv files. There's a .csv file for each cognitive task (CRT, Flanker, RDM) and each survey (Big5 one for each trait, bis=impulsivity, sc=self control, mask, and dem=demographics). Think about your hypotheses and which datasets you'll need. 

But first, in Part 2, we'll go through a few examples of how to load in the tidy data, how to visualize results, and what statistical analyses to use. 

### Example 1: Is gender correlated with RDM performance (accuracy and RT) on easy trials? (categorical and continuous)
```{r}
gender_dat <- read.csv("clean_data/tidy_dem.csv") %>%
  as_tibble() # 30 rows, 1 row per participant

rdm_dat <- read.csv("clean_data/tidy_rdm_dat.csv") %>%
  as_tibble()# 60 rows, 2 rows per participant: 1 for easy trials and 1 for hard trials

```

Let's join our two tidy datasets into one and save it as "tidy_data"
Now, we have all the data we need in one place! 
```{r}
tidy_data <- left_join(gender_dat, rdm_dat, by = "pid") %>%
  filter(ease == "easy") %>%  # we're only interested in the incongruent trials
  select(pid, gender, ease, rdm_mean_acc, rdm_mean_rt)
  
str(tidy_data) 

tidy_data$gender <- as.factor(tidy_data$gender) # changes gender from a character to factor

# let's look at male scores first 
male_scores <- tidy_data %>%
  filter(gender == "Male")
mean(male_scores$rdm_mean_acc)
mean(male_scores$rdm_mean_rt)

# and now female scores
female_scores <- tidy_data %>%
  filter(gender == "Female")
mean(female_scores$rdm_mean_acc)
mean(female_scores$rdm_mean_rt)


```

Let's look at a boxplot for this data:
```{r}
# let's create a plot! we want gender on the x axis and RDM scores on the y
ggplot(tidy_data, aes(x=gender, y=rdm_mean_acc)) +
  geom_boxplot() +
  geom_jitter() +
  labs(x = "Gender", y = "Accuracy (Proportion Correct)") +
  ylim(.6, 1) + # sets the y boundaries
  theme_bw() # changes the theme to black and white 

# let's only include male and female for the next plot because there's only 1 data point for "Other" and "Prefer not to say"
tidy_data_m_f <- tidy_data %>%
  filter(gender == "Male" | gender == "Female")

ggplot(tidy_data_m_f, aes(x=gender, y=rdm_mean_acc)) +
  geom_boxplot() +
  geom_jitter() +
  labs(x = "Gender", y = "Accuracy (Proportion Correct)") +
  ylim(.6, 1) + # sets the y boundaries
  theme_bw()

# we'll do a very similar analysis, but this time for response time (RT)
ggplot(tidy_data_m_f, aes(x=gender, y=rdm_mean_rt)) +
  geom_boxplot() +
  geom_jitter() +
  labs(x = "Gender", y = "Response Time (seconds)") +
  theme_bw() # changes the theme to black and white 

```

is there a difference in accuracy or RTs between male and females?? Because we have two groups (female and male) we can do a t test to test if there is a difference
```{r}
female_scores$rdm_mean_acc # list of female scores
male_scores$rdm_mean_acc # list of male scores
 
t.test(female_scores$rdm_mean_acc, male_scores$rdm_mean_acc) # p = 0.405 so we fail to reject the null hypothesis or we can say there is evidence that there is no difference between male and female flanker accuracy

t.test(female_scores$rdm_mean_rt, male_scores$rdm_mean_rt)

```


### Example 2: is neuroticism correlated with mask wearing behavior (continuous and continuous)
```{r}
tidy_big5_N = read.csv("clean_data/tidy_big5_N.csv") %>%
  as_tibble()
tidy_big5_N

tidy_mask = read.csv("clean_data/tidy_mask.csv") %>%
  as_tibble()
tidy_mask

tidy_ex2 <- left_join(tidy_big5_N, tidy_mask, by = "pid")
tidy_ex2 # we see a lot of NAs because we excluded participants who responded "yes" to a question on the mask wearing survey, so we were left with 18 participant resposnes for the mask survey. So, we need to exclude the participants with NAs here

tidy_ex2 <- tidy_ex2 %>%
  na.omit() %>% # now, we have the 18 participants
  select(pid, big5_mean_score, mask_mean_score)
```

Let's look at a scatter plot for this data:
```{r}
tidy_ex2

ggplot(tidy_ex2, aes(x = big5_mean_score, y = mask_mean_score)) + 
  geom_jitter() +
  geom_smooth(method="lm") + # linear regression without standard error
  labs(x = "Big 5 Mean Score", y = "Mask Behavior Mean Score") +
  theme_bw()
```

A couple of things to note with this plot:
1) it becomes rather apparent that there aren't many data points
2) even though the regression line or "line of best fit" looks like it's going down, the dots appear to be scattered all over and maybe the two points in the bottom right corner are pulling the data down

So, now let's look at a correlation and correlation test
```{r}
cor(tidy_ex2$big5_mean_score, tidy_ex2$mask_mean_score) # we see there is a slight negative correlation
cor.test(tidy_ex2$big5_mean_score, tidy_ex2$mask_mean_score) # p value is greater than 0.05
```

### Example 3: is there a relationship between neuroticism and age? (categorical and categorical)
```{r}
age_dat <- read.csv("clean_data/tidy_dem.csv") %>%
  as_tibble() %>%
  select(pid, age)

tidy_ex3 <- left_join(age_dat, tidy_big5_N, by = "pid") %>%
  select(pid, age, big5_N_group)

tidy_ex3$age <- as.factor(tidy_ex3$age)
tidy_ex3$big5_N_group <- as.factor(tidy_ex3$big5_N_group)

tidy_ex3


ggplot(tidy_ex3, aes(big5_N_group, ..count..)) + geom_bar(aes(fill = age), position = "dodge")

# ex3_table <- table(tidy_ex3$age, tidy_ex3$big5_N_group)
# ex3_table
# chisq.test(ex3_table)
```

split data into under 18 and above 18
```{r}

age_dat <- read.csv("clean_data/tidy_dem.csv") %>%
  as_tibble() %>%
  select(pid, age) %>%
  mutate(age_young_old = ifelse(age == "Under 18", "young", "old"))

age_dat %>%
  group_by(age_young_old) %>%
  count()

tidy_ex3 <- left_join(age_dat, tidy_big5_N, by = "pid") %>%
  select(pid, age_young_old, big5_N_group)

tidy_ex3$age_young_old <- as.factor(tidy_ex3$age_young_old)
tidy_ex3$big5_N_group <- as.factor(tidy_ex3$big5_N_group)

tidy_ex3


ggplot(tidy_ex3, aes(big5_N_group, ..count..)) + geom_bar(aes(fill = age_young_old), position = "dodge") +
  theme_bw() +
  labs(x = "Big 5 Neuroticism") +
  easy_remove_legend_title() +
  easy_text_size(size = 20)
  

ex3_table <- table(tidy_ex3$age_young_old, tidy_ex3$big5_N_group)
ex3_table
chisq.test(ex3_table)
```

#### PART 3 #### 

Now it's your turn! 
Your task here is to create plots to visualize your hypothesis and complete at least one statistical analysis. Refer to the recorded R lecture and the examples above for help. 

### Descriptive Statistics
You can start with descriptive statistics. Start with saving the mean, median, max. and min. for each of your variables under different names. This may help you not only to describe the variables you inspect, but also to better understand the results of your statistical testing. 

```{r}
crt_dat <- read.csv("clean_data/tidy_crt_dat.csv") %>%
  as_tibble()

ggplot(crt_dat, aes(x=crt_group, y=mean_acc)) +
  geom_jitter() +
  theme_bw() +
  easy_text_size(20)

```

### Raw Data Plotting
Choose the suitable plots for your data and plot is below. Note that, different hypotheses require different plotting: for example Scatter plot, Histogram or Boxplot. 

```{r}

```

### Statistical (Hypothesis) Testing
the last part of your analysis is to statistically test your hypothesis. Below, run the suitable statistical test for your hypothesis. Don't forget to save the results into a  new variable.

```{r}

```

### Secondary/Exploratory Analysis
If you got this far (well done!!!) and you feel like doing even more, take a closer look into the full dataset again and think about additional variables that you could be interested in and that could, perhaps, provide a fuller picture to your hypothesis. 

```{r}

```

